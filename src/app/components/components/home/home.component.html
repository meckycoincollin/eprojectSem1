<div class="loading-container" *ngIf="loading">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p>Loading beautiful lighting collections...</p>
</div>

<div class="alert alert-danger" *ngIf="error">
  {{ error }}
</div>

<div *ngIf="!loading && !error">
  <!-- Hero Banner: Lighting Categories -->
  <div class="main-banner">
    <div class="owl-carousel owl-banner">
      <!-- Ceiling Lights -->
      <div class="item item-1">
      </div>

      <!-- Lamps -->
      <div class="item item-2">
      </div>

      <!-- Outdoor Lights -->
      <div class="item item-3">
      </div>
    </div>
  </div>

  <!-- About Us Section -->
  <div class="featured section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="left-image">
            <img src="assets/images/f_light.jpg" alt="Featured lighting" height="300px">
          </div>
        </div>
        <div class="col-lg-5">
          <div class="section-heading">
            <h6>| About Us</h6>
            <h2>
              {{ companyInfo?.name || 'Chic Lighting & Design' }} -
              {{ companyInfo?.slogan || 'Illuminate Your Spaces Beautifully' }}
            </h2>
          </div>
          <div class="accordion" id="accordionExample">
            <!-- Our Story -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
                  aria-expanded="true" aria-controls="collapseOne">
                  Our Story
                </button>
              </h2>
              <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  {{ companyInfo?.description || 'Chic Lighting & Design Vietnam is a specialist showroom for decorative
                  and architectural lighting: chandeliers, pendants, lamps, wall lights and outdoor fixtures for homes,
                  cafes, showrooms and offices.' }}
                </div>
              </div>
            </div>
            <!-- Our Services -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  Our Services
                </button>
              </h2>
              <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  We offer comprehensive <strong>lighting design consultation</strong>,
                  supply &amp; installation, and <strong>maintenance services</strong> for
                  residential and commercial projects. From concept to final installation,
                  our team helps you create the right ambience and functionality for every space.
                </div>
              </div>
            </div>
            <!-- Our Brands -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingThree">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  Our Brands
                </button>
              </h2>
              <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  We carry a wide selection of lighting brands such as
                  <strong>Philips, OSRAM, Artemide, Delta Light, Tom Dixon</strong> and more.
                  Each piece in our collection represents design, quality and reliability.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Info table -->
        <div class="col-lg-3">
          <div class="info-table">
            <ul>
              <li>
                <div class="icon-container">
                  <i class="fas fa-lightbulb"></i>
                </div>
                <h4>Design Expertise<br><span>Lighting Specialists</span></h4>
              </li>
              <li>
                <div class="icon-container">
                  <i class="fas fa-drafting-compass"></i>
                </div>
                <h4>Project Support<br><span>Homes &amp; Commercial</span></h4>
              </li>
              <li>
                <div class="icon-container">
                  <i class="fas fa-sun"></i>
                </div>
                <h4>Wide Selection<br><span>Decorative &amp; Technical</span></h4>
              </li>
              <li>
                <div class="icon-container">
                  <i class="fas fa-shield-alt"></i>
                </div>
                <h4>Warranty<br><span>Reliable After-Sales</span></h4>
              </li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Craftsmanship Section -->
  <div class="video section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Innovation &amp; Excellence</h6>
            <h2>The Art of Lighting Design</h2>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="video-content">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 offset-lg-1">
          <div class="video-frame">
            <img src="assets/images/light.png" alt="Lighting showroom">
            <a href="https://youtube.com" target="_blank"><i class="fa fa-play"></i></a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Section -->
  <div class="fun-facts">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="wrapper">
            <div class="row">
              <div class="col-lg-4">
                <div class="counter">
                  <h2 class="timer count-title count-number" [attr.data-to]="statistics?.yearsInBusiness || 54"
                    data-speed="1000"></h2>
                  <p class="count-text">Years<br>of Expertise</p>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="counter">
                  <h2 class="timer count-title count-number" [attr.data-to]="statistics?.LightServiced || 60000"
                    data-speed="1000"></h2>
                  <p class="count-text">Lighting<br>Projects Serviced</p>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="counter">
                  <h2 class="timer count-title count-number" [attr.data-to]="statistics?.brandsAvailable || 5"
                    data-speed="1000"></h2>
                  <p class="count-text">Lighting Brands<br>Available</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Collections Section with Tabs -->
  <div class="section best-deal">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="section-heading">
            <h6>| Collections</h6>
            <h2>Discover Our Lighting Collections</h2>
          </div>
        </div>
        <div class="col-lg-12">
          <div class="tabs-content">
            <div class="row">
              <div class="nav-wrapper">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item" role="presentation" *ngFor="let category of categories; let i = index">
                    <button class="nav-link" [class.active]="i === 0" [id]="category.id + '-tab'" data-bs-toggle="tab"
                      [attr.data-bs-target]="'#' + category.id" type="button" role="tab"
                      [attr.aria-controls]="category.id" [attr.aria-selected]="i === 0">
                      {{ category.name }}
                    </button>
                  </li>
                </ul>
              </div>
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade" *ngFor="let category of categories; let i = index" [class.show]="i === 0"
                  [class.active]="i === 0" [id]="category.id" role="tabpanel"
                  [attr.aria-labelledby]="category.id + '-tab'">
                  <div class="row">
                    <div class="col-lg-3">
                      <div class="info-table">
                        <ul>
                          <!-- Ceiling Lights -->
                          <ng-container *ngIf="category.id === 'ceiling'">
                            <li>Application <span>Living, Dining, Bedroom</span></li>
                            <li>Mounting <span>Chandelier / Pendant / Flush</span></li>
                            <li>Light Source <span>LED / Smart Bulbs</span></li>
                            <li>Control <span>Switch / Dimmer</span></li>
                            <li>Style <span>Modern &amp; Classic</span></li>
                          </ng-container>

                          <!-- Lamps -->
                          <ng-container *ngIf="category.id === 'lamps'">
                            <li>Type <span>Table &amp; Floor</span></li>
                            <li>Usage <span>Reading / Accent</span></li>
                            <li>Light Source <span>LED Bulbs</span></li>
                            <li>Features <span>Adjustable / Portable</span></li>
                            <li>Best For <span>Bedroom &amp; Study</span></li>
                          </ng-container>

                          <!-- Outdoor Lights -->
                          <ng-container *ngIf="category.id === 'outdoor'">
                            <li>Location <span>Garden / Path / Façade</span></li>
                            <li>Protection <span>IP65+</span></li>
                            <li>Housing <span>Aluminium / Stainless</span></li>
                            <li>Light Source <span>Integrated LED</span></li>
                            <li>Benefits <span>Safety &amp; Ambience</span></li>
                          </ng-container>

                          <!-- Smart & Accent -->
                          <ng-container *ngIf="category.id === 'homeAccent'">
                            <li>Type <span>Smart Bulbs &amp; Strips</span></li>
                            <li>Control <span>App &amp; Voice</span></li>
                            <li>Colors <span>RGB &amp; Tunable White</span></li>
                            <li>Use Cases <span>Cove / Feature Walls</span></li>
                            <li>Integrations <span>Smart Home Systems</span></li>
                          </ng-container>
                        </ul>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <img class="category-img"
                        [src]="category.image || ('assets/images/categories/' + category.id + '.jpg')"
                        [alt]="category.name">
                    </div>

                    <div class="col-lg-3">
                      <h4>{{ category.name }}</h4>
                      <p>{{ category.description }}</p>
                      <div class="icon-button">
                        <a [routerLink]="['/products']" [queryParams]="{category: category.id}">
                          <i class="fa fa-eye"></i> View Collection
                        </a>
                      </div>
                    </div>
                  </div>
                </div> <!-- tab-pane -->
              </div> <!-- tab-content -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Featured Products Section -->
  <div class="properties section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Featured Products</h6>
            <h2>Discover Our Most Loved Lights</h2>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Featured product items -->
        <div class="col-lg-4 col-md-6" *ngFor="let product of featuredProducts">
          <div class="item">
            <!-- Ảnh luôn ở trên -->
            <a href="javascript:void(0)" (click)="openProductDetails(product)">
              <img style="width: 295px; height: 295px; object-fit: contain;"
                [src]="product.images && product.images.length > 0 ? product.images[0] : 'assets/images/default-light.jpg'"
                [alt]="product.name">
            </a>

            <!-- Tên & giá cùng một dòng, giống list-product -->
            <div class="product-header d-flex justify-content-between align-items-center mt-2 mb-2">
              <h4 class="product-name mb-0">
                <a href="javascript:void(0)" (click)="openProductDetails(product)">
                  {{ product.name }}
                </a>
              </h4>

              <h6 class="product-price mb-0 text-end">
                <ng-container *ngIf="product.discount; else normalPriceHome">
                  <div class="final-price fw-bold">
                    {{ (product.price * (1 - product.discount / 100)) | currency:'USD':'symbol':'1.0-0' }}
                  </div>
                  <div class="original-price text-muted" style="font-size: 0.85rem;">
                    <s>{{ product.price | currency:'USD':'symbol':'1.0-0' }}</s>
                    <span class="text-danger ms-1">-{{ product.discount }}%</span>
                  </div>
                </ng-container>

                <ng-template #normalPriceHome>
                  {{ product.price | currency:'USD':'symbol':'1.0-0' }}
                </ng-template>
              </h6>
            </div>

            <!-- (tuỳ chọn) badge theo category -->
            <span class="category">
              {{ product.categoryId === 'ceiling' ? 'Ceiling Lights' :
              product.categoryId === 'lamps' ? 'Lamps' :
              product.categoryId === 'outdoor' ? 'Outdoor Lighting' :
              'Smart & Accent Lighting' }}
            </span>

            <ul>
              <li *ngIf="product.specifications?.engine">
                Light Source: <span>{{ product.specifications.engine }}</span>
              </li>
              <li *ngIf="product.specifications?.power">
                Power / Output: <span>{{ product.specifications.power }}</span>
              </li>
              <li *ngIf="product.specifications?.drivetrain">
                Application: <span>{{ product.specifications.drivetrain }}</span>
              </li>
              <li *ngIf="product.specifications?.transmission">
                Control / Mode: <span>{{ product.specifications.transmission }}</span>
              </li>
              <li *ngIf="product.specifications?.topSpeed">
                Performance: <span>{{ product.specifications.topSpeed }}</span>
              </li>
              <li *ngIf="product.specifications?.zeroToHundred">
                Notes: <span>{{ product.specifications.zeroToHundred }}</span>
              </li>
              <li>Warranty: <span>{{ product.warranty }}</span></li>
              <li>
                Availability:
                <span [class.text-success]="product.inStock" [class.text-danger]="!product.inStock">
                  {{ product.inStock ? 'In Stock' : 'Out of Stock' }}
                </span>
              </li>
            </ul>

            <div class="main-button">
              <a href="javascript:void(0)" (click)="openProductDetails(product)">View Details</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Contact Section -->
  <div class="contact section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 offset-lg-4">
          <div class="section-heading text-center">
            <h6>| Contact Us</h6>
            <h2>Get In Touch With Our Lighting Experts</h2>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="contact-content">
    <div class="container">
      <div class="row">
        <div class="col-lg-7">
          <div id="map">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3724.1155335517404!2d105.84115007599775!3d21.02754148052354!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135ab9b4a79fa85%3A0xd4c01582479b0553!2sHoan%20Kiem%20Lake!5e0!3m2!1sen!2s!4v1684210063387!5m2!1sen!2s"
              width="100%" height="500px" frameborder="0"
              style="border:0; border-radius: 10px; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.15);"
              allowfullscreen=""></iframe>
          </div>
          <div class="row">
            <div class="col-lg-6">
              <div class="item phone">
                <h6>{{ companyInfo?.contact?.phone || '+84 123 456 7890' }}<br><span>Phone Number</span></h6>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="item email">
                <h6>{{ companyInfo?.contact?.email || 'info@chiclighting.vn' }}<br><span>Business Email</span></h6>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-5">
          <form id="contact-form" [formGroup]="contactForm" (ngSubmit)="onSubmitContactForm()">
            <div class="row">
              <div class="col-lg-12">
                <fieldset>
                  <label for="name">Full Name</label>
                  <input type="text" formControlName="name" id="name" placeholder="Your Name..." autocomplete="on">
                  <div *ngIf="contactForm.get('name')?.invalid && contactForm.get('name')?.touched" class="text-danger">
                    Name is required
                  </div>
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <label for="email">Email Address</label>
                  <input type="email" formControlName="email" id="email" placeholder="Your E-mail...">
                  <div *ngIf="contactForm.get('email')?.invalid && contactForm.get('email')?.touched"
                    class="text-danger">
                    Valid email is required
                  </div>
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <label for="subject">Subject</label>
                  <input type="text" formControlName="subject" id="subject" placeholder="Subject..." autocomplete="on">
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <label for="message">Message</label>
                  <textarea formControlName="message" id="message" placeholder="Your Message"></textarea>
                  <div *ngIf="contactForm.get('message')?.invalid && contactForm.get('message')?.touched"
                    class="text-danger">
                    Message is required
                  </div>
                </fieldset>
              </div>
              <div class="col-lg-12">
                <fieldset>
                  <button type="submit" id="form-submit" class="orange-button" [disabled]="contactForm.invalid">
                    Send Message
                  </button>
                </fieldset>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<app-product-detail-modal [product]="selectedProduct" [category]="selectedCategory" [relatedProducts]="relatedProducts"
  [loading]="modalLoading" (closeModal)="onCloseModal()" (viewRelatedProduct)="onViewRelatedProduct($event)">
</app-product-detail-modal>